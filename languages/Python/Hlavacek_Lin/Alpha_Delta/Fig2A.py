from numpy import *
from scipy.stats import loguniform
from scipy.integrate import solve_ivp
from scipy.special import loggamma
from scipy.optimize import minimize
from sys import argv
from numba import njit
from matplotlib import cm
import random
import matplotlib
import matplotlib.pyplot as plt
from scipy.io import loadmat
plt.rcParams.update({'font.family':'sans','font.size':12,'image.cmap':'plasma'})
colors1 = cm.Blues(linspace(0,1,9))
colors2 = cm.Reds(linspace(0,1,9))
dateIndex = ['2020-01-21', '2020-01-22', '2020-01-23', '2020-01-24', '2020-01-25', '2020-01-26', '2020-01-27', '2020-01-28', '2020-01-29', '2020-01-30', '2020-01-31', '2020-02-01', '2020-02-02', '2020-02-03', '2020-02-04', '2020-02-05', '2020-02-06', '2020-02-07', '2020-02-08', '2020-02-09', '2020-02-10', '2020-02-11', '2020-02-12', '2020-02-13', '2020-02-14', '2020-02-15', '2020-02-16', '2020-02-17', '2020-02-18', '2020-02-19', '2020-02-20', '2020-02-21', '2020-02-22', '2020-02-23', '2020-02-24', '2020-02-25', '2020-02-26', '2020-02-27', '2020-02-28', '2020-02-29', '2020-03-01', '2020-03-02', '2020-03-03', '2020-03-04', '2020-03-05', '2020-03-06', '2020-03-07', '2020-03-08', '2020-03-09', '2020-03-10', '2020-03-11', '2020-03-12', '2020-03-13', '2020-03-14', '2020-03-15', '2020-03-16', '2020-03-17', '2020-03-18', '2020-03-19', '2020-03-20', '2020-03-21', '2020-03-22', '2020-03-23', '2020-03-24', '2020-03-25', '2020-03-26', '2020-03-27', '2020-03-28', '2020-03-29', '2020-03-30', '2020-03-31', '2020-04-01', '2020-04-02', '2020-04-03', '2020-04-04', '2020-04-05', '2020-04-06', '2020-04-07', '2020-04-08', '2020-04-09', '2020-04-10', '2020-04-11', '2020-04-12', '2020-04-13', '2020-04-14', '2020-04-15', '2020-04-16', '2020-04-17', '2020-04-18', '2020-04-19', '2020-04-20', '2020-04-21', '2020-04-22', '2020-04-23', '2020-04-24', '2020-04-25', '2020-04-26', '2020-04-27', '2020-04-28', '2020-04-29', '2020-04-30', '2020-05-01', '2020-05-02', '2020-05-03', '2020-05-04', '2020-05-05', '2020-05-06', '2020-05-07', '2020-05-08', '2020-05-09', '2020-05-10', '2020-05-11', '2020-05-12', '2020-05-13', '2020-05-14', '2020-05-15', '2020-05-16', '2020-05-17', '2020-05-18', '2020-05-19', '2020-05-20', '2020-05-21', '2020-05-22', '2020-05-23', '2020-05-24', '2020-05-25', '2020-05-26', '2020-05-27', '2020-05-28', '2020-05-29', '2020-05-30', '2020-05-31', '2020-06-01', '2020-06-02', '2020-06-03', '2020-06-04', '2020-06-05', '2020-06-06', '2020-06-07', '2020-06-08', '2020-06-09', '2020-06-10', '2020-06-11', '2020-06-12', '2020-06-13', '2020-06-14', '2020-06-15', '2020-06-16', '2020-06-17', '2020-06-18', '2020-06-19', '2020-06-20', '2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-26', '2020-06-27', '2020-06-28', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-04', '2020-07-05', '2020-07-06', '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-11', '2020-07-12', '2020-07-13', '2020-07-14', '2020-07-15', '2020-07-16', '2020-07-17', '2020-07-18', '2020-07-19', '2020-07-20', '2020-07-21', '2020-07-22', '2020-07-23', '2020-07-24', '2020-07-25', '2020-07-26', '2020-07-27', '2020-07-28', '2020-07-29', '2020-07-30', '2020-07-31', '2020-08-01', '2020-08-02', '2020-08-03', '2020-08-04', '2020-08-05', '2020-08-06', '2020-08-07', '2020-08-08', '2020-08-09', '2020-08-10', '2020-08-11', '2020-08-12', '2020-08-13', '2020-08-14', '2020-08-15', '2020-08-16', '2020-08-17', '2020-08-18', '2020-08-19', '2020-08-20', '2020-08-21', '2020-08-22', '2020-08-23', '2020-08-24', '2020-08-25', '2020-08-26', '2020-08-27', '2020-08-28', '2020-08-29', '2020-08-30', '2020-08-31', '2020-09-01', '2020-09-02', '2020-09-03', '2020-09-04', '2020-09-05', '2020-09-06', '2020-09-07', '2020-09-08', '2020-09-09', '2020-09-10', '2020-09-11', '2020-09-12', '2020-09-13', '2020-09-14', '2020-09-15', '2020-09-16', '2020-09-17', '2020-09-18', '2020-09-19', '2020-09-20', '2020-09-21', '2020-09-22', '2020-09-23', '2020-09-24', '2020-09-25', '2020-09-26', '2020-09-27', '2020-09-28', '2020-09-29', '2020-09-30', '2020-10-01', '2020-10-02', '2020-10-03', '2020-10-04', '2020-10-05', '2020-10-06', '2020-10-07', '2020-10-08', '2020-10-09', '2020-10-10', '2020-10-11', '2020-10-12', '2020-10-13', '2020-10-14', '2020-10-15', '2020-10-16', '2020-10-17', '2020-10-18', '2020-10-19', '2020-10-20', '2020-10-21', '2020-10-22', '2020-10-23', '2020-10-24', '2020-10-25', '2020-10-26', '2020-10-27', '2020-10-28', '2020-10-29', '2020-10-30', '2020-10-31', '2020-11-01', '2020-11-02', '2020-11-03', '2020-11-04', '2020-11-05', '2020-11-06', '2020-11-07', '2020-11-08', '2020-11-09', '2020-11-10', '2020-11-11', '2020-11-12', '2020-11-13', '2020-11-14', '2020-11-15', '2020-11-16', '2020-11-17', '2020-11-18', '2020-11-19', '2020-11-20', '2020-11-21', '2020-11-22', '2020-11-23', '2020-11-24', '2020-11-25', '2020-11-26', '2020-11-27', '2020-11-28', '2020-11-29', '2020-11-30','2020-12-01', '2020-12-02', '2020-12-03', '2020-12-04', '2020-12-05', '2020-12-06', '2020-12-07', '2020-12-08', '2020-12-09', '2020-12-10', '2020-12-11', '2020-12-12', '2020-12-13', '2020-12-14', '2020-12-15', '2020-12-16', '2020-12-17', '2020-12-18', '2020-12-19', '2020-12-20', '2020-12-21', '2020-12-22', '2020-12-23', '2020-12-24', '2020-12-25', '2020-12-26', '2020-12-27', '2020-12-28', '2020-12-29', '2020-12-30','2020-12-31', '2021-01-01', '2021-01-02', '2021-01-03', '2021-01-04', '2021-01-05', '2021-01-06', '2021-01-07', '2021-01-08', '2021-01-09', '2021-01-10', '2021-01-11', '2021-01-12', '2021-01-13', '2021-01-14', '2021-01-15', '2021-01-16', '2021-01-17', '2021-01-18', '2021-01-19', '2021-01-20', '2021-01-21', '2021-01-22', '2021-01-23', '2021-01-24', '2021-01-25', '2021-01-26', '2021-01-27', '2021-01-28', '2021-01-29', '2021-01-30', '2021-01-31', '2021-02-01', '2021-02-02', '2021-02-03', '2021-02-04', '2021-02-05', '2021-02-06', '2021-02-07', '2021-02-08', '2021-02-09', '2021-02-10', '2021-02-11', '2021-02-12', '2021-02-13', '2021-02-14', '2021-02-15', '2021-02-16', '2021-02-17', '2021-02-18', '2021-02-19', '2021-02-20', '2021-02-21', '2021-02-22', '2021-02-23', '2021-02-24', '2021-02-25', '2021-02-26', '2021-02-27', '2021-02-28', '2021-02-29', '2021-03-01', '2021-03-02', '2021-03-03', '2021-03-04', '2021-03-05', '2021-03-06', '2021-03-07', '2021-03-08', '2021-03-09', '2021-03-10', '2021-03-11', '2021-03-12', '2021-03-13', '2021-03-14', '2021-03-15', '2021-03-16', '2021-03-17', '2021-03-18', '2021-03-19', '2021-03-20', '2021-03-21', '2021-03-22', '2021-03-23', '2021-03-24', '2021-03-25', '2021-03-26', '2021-03-27', '2021-03-28', '2021-03-29', '2021-03-30', '2021-03-31', '2021-04-01', '2021-04-02', '2021-04-03', '2021-04-04', '2021-04-05', '2021-04-06', '2021-04-07', '2021-04-08', '2021-04-09', '2021-04-10', '2021-04-11', '2021-04-12', '2021-04-13', '2021-04-14', '2021-04-15', '2021-04-16', '2021-04-17', '2021-04-18', '2021-04-19', '2021-04-20', '2021-04-21', '2021-04-22', '2021-04-23', '2021-04-24', '2021-04-25', '2021-04-26', '2021-04-27', '2021-04-28', '2021-04-29', '2021-04-30', '2021-05-01', '2021-05-02', '2021-05-03', '2021-05-04', '2021-05-05', '2021-05-06', '2021-05-07', '2021-05-08', '2021-05-09', '2021-05-10', '2021-05-11', '2021-05-12', '2021-05-13', '2021-05-14', '2021-05-15', '2021-05-16', '2021-05-17', '2021-05-18', '2021-05-19', '2021-05-20', '2021-05-21', '2021-05-22', '2021-05-23', '2021-05-24', '2021-05-25', '2021-05-26', '2021-05-27', '2021-05-28', '2021-05-29', '2021-05-30', '2021-05-31', '2021-06-01', '2021-06-02', '2021-06-03', '2021-06-04', '2021-06-05', '2021-06-06', '2021-06-07', '2021-06-08', '2021-06-09', '2021-06-10', '2021-06-11', '2021-06-12', '2021-06-13', '2021-06-14', '2021-06-15', '2021-06-16', '2021-06-17', '2021-06-18', '2021-06-19', '2021-06-20', '2021-06-21', '2021-06-22', '2021-06-23', '2021-06-24', '2021-06-25', '2021-06-26', '2021-06-27', '2021-06-28', '2021-06-29', '2021-06-30', '2021-07-01', '2021-07-02', '2021-07-03', '2021-07-04', '2021-07-05', '2021-07-06', '2021-07-07', '2021-07-08', '2021-07-09', '2021-07-10', '2021-07-11', '2021-07-12', '2021-07-13', '2021-07-14', '2021-07-15', '2021-07-16', '2021-07-17', '2021-07-18', '2021-07-19', '2021-07-20', '2021-07-21', '2021-07-22', '2021-07-23', '2021-07-24', '2021-07-25', '2021-07-26', '2021-07-27', '2021-07-28', '2021-07-29', '2021-07-30', '2021-07-31', '2021-08-01', '2021-08-02', '2021-08-03', '2021-08-04', '2021-08-05', '2021-08-06', '2021-08-07', '2021-08-08', '2021-08-09', '2021-08-10', '2021-08-11', '2021-08-12', '2021-08-13', '2021-08-14', '2021-08-15', '2021-08-16', '2021-08-17', '2021-08-18', '2021-08-19', '2021-08-20', '2021-08-21', '2021-08-22', '2021-08-23', '2021-08-24', '2021-08-25', '2021-08-26', '2021-08-27', '2021-08-28', '2021-08-29', '2021-08-30', '2021-08-31', '2021-09-01', '2021-09-02', '2021-09-03', '2021-09-04', '2021-09-05', '2021-09-06', '2021-09-07', '2021-09-08', '2021-09-09', '2021-09-10', '2021-09-11', '2021-09-12', '2021-09-13', '2021-09-14', '2021-09-15', '2021-09-16', '2021-09-17', '2021-09-18', '2021-09-19', '2021-09-20', '2021-09-21', '2021-09-22', '2021-09-23', '2021-09-24', '2021-09-25', '2021-09-26', '2021-09-27', '2021-09-28', '2021-09-29', '2021-09-30', '2021-10-01', '2021-10-02', '2021-10-03', '2021-10-04', '2021-10-05', '2021-10-06', '2021-10-07', '2021-10-08', '2021-10-09', '2021-10-10', '2021-10-11', '2021-10-12', '2021-10-13', '2021-10-14', '2021-10-15', '2021-10-16', '2021-10-17', '2021-10-18', '2021-10-19', '2021-10-20', '2021-10-21', '2021-10-22', '2021-10-23', '2021-10-24', '2021-10-25', '2021-10-26', '2021-10-27', '2021-10-28', '2021-10-29', '2021-10-30', '2021-10-31']
NYTNewCases = array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,5,1,6,3,6,5,1,12,20,46,43,53,52,50,21,64,191,183,97,55,163,135,277,196,198,160,134,170,181,275,228,207,196,206,199,174,193,146,380,203,129,125,243,250,260,264,283,238,204,249,251,316,404,370,325,317,391,419,498,461,377,761,368,374,565,451,323,336,332,390,407,341,353,344,257,231,184,348,409,401,371,373,315,281,388,443,479,551,440,361,565,543,598,626,759,562,420,641,607,834,859,799,778,948,738,958,1487,1045,1006,1365,1118,1088,1677,1551,1515,1597,1482,1818,2342,2363,2325,2229,2239,1949,1787,1735,2307,2502,1957,2268,1648,1657,1634,2082,1823,1616,1442,2236,1269,913,2259,1961,1589,3064,67,2226,863,2437,2867,1424,1492,1840,1737,1274,1582,1332,1579,2871,2866,6072,2399,2379,920,878,1366,1543,640,491,1018,1183,771,812,1271,281,1201,1339,815,439,944,971,416,115,950,1204,494,909,675,329,1389,1189,998,1081,1113,718,1319,812,989,1072,1655,482,721,1996,857,1729,874,629,492,2983,1275,847,883,2449,1099,1062,1163,1294,879,1529,1550,1625,1516,1817,1168,936,1265,1822,1315,1920,2337,1524,1296,1661,1741,1906,1097,2625,1752,2440,2095,2168,1675,3724,1258,2535,3321,3442,2994,2353,3214,3396,3256,3069,2063,4016,5000,4296,4421,4124,2552,6226,3773,897,626,1609,5506,4834,3742,6499,6159,3539,4274,4079,4498,4324,4432,5016,12974,4127,1900,5526,6913,6342,6792,8117,5539,1385,5927,7355,7241,1930,74,2920,7506,10318,6419,6030,7251,1247,4071,8154,9208,10210,8892,7553,7547,5919,6108,8359,9861,8180,7303,6874,4802,5068,5235,5461,10277,5689,6286,3873,3574,6152,4750,6624,6475,5240,2774,3814,6807,5845,4982,4475,4453,2547,2590,3869,4155,4277,3889,3176,1904,1806,890,1735,2429,878,1170,1178,351,1916,2571,2470,2556,2594,2078,189,2557,1925,2251,2766,1564,948,425,1207,2010,1888,1510,1367,488,342,1513,1236,907,1077,883,356,142,1224,994,694,652,1041,506,172,1287,818,1108,919,444,331,139,654,1421,796,636,915,466,278,671,1383,640,752,718,456,353,601,1247,654,740,641,322,631,430,1251,953,879,861,599,506,665,883,569,702,568,337,454,439,715,287,702,663,204,268,402,1216,340,408,290,237,291,336,596,372,243,501,123,51,50,51,521,428,336,110,175,229,208,450,356,254,941,156,254,474,371,525,301,271,286,200,402,283,480,389,91,63,334,371,451,193,559,331,37,27,387,557,600,641,363,142,446,763,1001,1052,1133,519,966,934,1145,1396,2006,1291,767,777,1274,2107,2788,2610,2227,1377,1186,1934,2789,3976,2866,3396,1405,886,2700,3775,5634,3443,3124,1923,1967,3101,4920,7079,3415,3060,2602,1257,2463,4288,6580,3942,5097,1787,749,4827,4526,7408,4882,6348,2972,236,898,3745,9247,10131,4726,2500,459,8590,6033,7207,4531,4560,2948,191,4634,3384,3462,2247,5070,1234,3683,3748,3465,4741,2774,3088,1639,202,3030,3165,3964,2802,2254,1422,80,2579,2866,3026,2082,2201,1337,104,1907,2012,2284,1876,1456,1044,141,1559,1881,1486,2193,1310,872,105])
fig = plt.figure()
fig.set_size_inches(8,5.5)
ax = plt.subplot(1,1,1)
ax2 = ax.twinx()
qtl = load('inferences/Dallas4-n5-percentiles.npy')
alph = loadmat('prevalence.mat')['alpha_prev_dallas']
delt = loadmat('prevalence.mat')['delta_prev_dallas']
tSpan = linspace(0, shape(qtl)[1]-1, shape(qtl)[1])
tSpanExp = linspace(0, len(NYTNewCases)-1, len(NYTNewCases))
ax.scatter(tSpanExp, NYTNewCases, 60, marker='+', linewidth = 1, color = 'black', zorder = 500)
qtlMark = [0.95,0.5,0.2]
ax.fill_between(tSpan, qtl[1,:], qtl[19,:], facecolor = colors1[4], zorder = 0, label=str(int(qtlMark[0]*100))+' % posterior')
ax.fill_between(tSpan, qtl[5,:], qtl[15,:], facecolor = colors1[6], zorder = 1, label=str(int(qtlMark[1]*100))+' % posterior')
ax.fill_between(tSpan, qtl[8,:], qtl[12,:], facecolor = colors1[8], zorder = 2, label=str(int(qtlMark[2]*100))+' % posterior')
ax.set_xticks(linspace(0,len(dateIndex)-1,16))
ax.set_xticklabels(['01-21-20','03-04-20','04-16-20','05-29-20','07-12-20','08-24-20','10-06-20','11-18-20','01-01-21','02-13-21','03-28-21','05-10-21','06-23-21','08-05-21','09-17-21','10-31-21'],rotation=90)
ax.set_xlim((0,len(dateIndex)-1))
ax.set_ylabel('Confirmed case counts')
ax.set_title('Dallas')
ax.set_ylim((0,13200))
ax2.set_ylim((0,1))
ax2.set_ylabel('Prevalence')
ax2.fill_between(linspace(374,650,40),alph.reshape(40),facecolor = 'yellow', zorder = 0, alpha = 0.5, label='Prevalence of Alpha variant')
ax2.fill_between(linspace(374,650,40),delt.reshape(40),facecolor = 'green', zorder = 0, alpha = 0.5, label='Prevalence of Delta variant')
fig.tight_layout()
fig.legend(loc = (0.24,0.6), frameon=False, fontsize=8)
plt.savefig('Fig2A.pdf')
plt.close()